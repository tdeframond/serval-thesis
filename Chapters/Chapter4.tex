\chapter{Functionnal Hardware testing of Serval Mesh Extender}


\section{Environmental testing}


\section{Post-assembly testing}

\subsection{Test 1 : Boot-loader and flash firmware update}

This is the very first task I have to implement. The goal is to prepare the manufactured Mesh Extender units for the tests and use. In order to do it, we have to install a special Linux distribution on it called OpenWrt. OpenWrt is an embedded operating system based on Linux, primarily used on embedded devices to route network traffic. All components have been optimized for size, to be small enough for fitting into the limited storage and memory available in home routers as the Serval Mesh Extender. \\
In order to install the latest version of the OS, we will use here the command-line interface Shell. This will allow to boot directly the Domino from a laptop. But at this point, we need to make these two entities capable of communicate to each other. That is why we need cables and especially one that can deals with the extender serial port. For this one, we have for the moment a home-made cable that use a D-SUB 25 pins male port on one side and whatever we want on the other side by cutting the edge of the cable and weld components on the desired nude wires. That is why we have welded here a serial port to USB adapter and a power plug to power the PCB. \\
So now we can talk to the PCB with the laptop through command lines. But there is a problem remaining. Serial port is too slow to transfer data and at some point, we will have to download on the Domino the OpenWrt software binaries. That is why we also use an ethernet cable to install the distribution in addition to the serial cable. \\ \\ 
The procedure is simple, we first connect the laptop and the Mesh Extender with the serial and ethernet cables. Then we plug the power cable in order to make the PCB run. We have to install the Serval software which create the OpenWrt files to transfer to the PCB on a linux environment. That is why we need to install VirtualBox on Macintosh laptop first. Then, just clone the repository OpenWrt from the Serval Project Github source and run the following commands :\\
> ./scripts/feeds update serval\\
> ./scripts/feeds install -p serval\\
> ./scriptes/feeds install -a serval\\
> make world\\ \\
Therefore, the binary for installation should then be in: bin/ar71xx/openwrt-ar71xx-generic-gl-ar150-initramfs-kernel.bin \\
To flash the PCB, we have to connect to the serial port at 115200 by typing:\\

> cu -l /dev/cu.usbserial -s 115200\\

or if we have trouble with cu: \\ 

> screen /dev/cu.usbserial 115200 \\

In either case, change /dev/cu.usbserial to the correct device name for the USB to serial adapter. Reboot the node in some way, so that you see the uboot prompt. Then press any key to interrupt the boot process.\\
The Mesh Extender node will have an IP of 192.168.1.1, so pick another IP address on that subnet for the connected computer and type "httpd" to start the firmware update webserver. Then, just browse to http://192.168.1.1 and select the firmware file to upload, and trigger the firmware update.  HELO
